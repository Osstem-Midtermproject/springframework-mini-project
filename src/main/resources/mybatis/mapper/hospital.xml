<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.HospitalDao">
	
	<select id="selectByPager" parameterType="pager"  resultMap="selectHospitalWithProgressResultMap">
		select rnum, hname, pdate, pcontent, hpn, pcategory, pdln, paddress, hdln, hdirector, hod, hemail, haddress
		    from (
		        select ROWNUM as rnum, hname, pdate, pcontent, hpn, pcategory, pdln, paddress, hdln, hdirector, hod, hemail, haddress
		        from (
		            SELECT hname, pdate, pcontent, hpn, pcategory, pdln, paddress, hdln, hdirector, hod, hemail, haddress
		            FROM hospital, progress
		            where hospital.hdln = progress.pdln and hospital.haddress = progress.paddress
		        )
		    where rownum &lt;= #{endRowNo}
		    )
		where rnum &gt;= #{startRowNo}
		
	</select>
	
	<select id="count" resultType="int">
		select count(*)
		from progress, hospital
		where hospital.hdln = progress.pdln and hospital.haddress = progress.paddress
	</select>
	
	<resultMap id="selectHospitalWithProgressResultMap" type="hospital">
		<result column="rnum" property="hno" />
		<result column="hname" property="hname" />
		<result column="hpn" property="hpn" />
		<result column="hdln" property="hdln" />
		<result column="hdirector" property="hdirector" />
		<result column="hod" property="hod" />
		<result column="hemail" property="hemail" />
		<result column="haddress" property="haddress" />
		<association property="progress" javaType="progress">
			<result column="pdate" property="pdate" />
			<result column="pcontent" property="pcontent" />
			<result column="pcategory" property="pcategory" />
			<result column="pdln" property="pdln" />
			<result column="paddress" property="paddress" />
		</association>
	</resultMap>
	
	
	<select id="selectByHdln" parameterType="string" resultMap="selectHospitalWithProgressResultMap">
		select * 
		from 
			(select *
			from progress, hospital
			where hospital.hdln = progress.pdln and hospital.haddress = progress.paddress and hospital.hdln=#{hdln}
			order by progress.pdate desc)
			where rownum = 1
	</select>
	
	<resultMap id="selectHospitalWithLocation" type="hospital">
		<result column="rnum" property="hno" />
		<result column="hname" property="hname" />
		<result column="hpn" property="hpn" />
		<result column="haddress" property="haddress" />
	</resultMap>
	
	<!-- 전체 지역별 출력 -->
	<select id="selectByLocation" parameterType="pager" resultMap="selectHospitalWithLocation">
		
		
		select rnum, hname, haddress, hpn	
          from (
              select ROWNUM as rnum, hname, haddress, hpn
              from (
                  SELECT hname, haddress, hpn
                  FROM hospital 
                 
                  <!-- 주소가 들어가야한다.  -->
                   )
         	    where rownum &lt;= #{endRowNo}
		    )
		where rnum &gt;= #{startRowNo}
	
	</select>
	
	<!-- 선택 지역별 출력 -->
	<!-- 페이저 처리 해야댐 제길 -->
	
	<select id="selectByLocation2" parameterType="String" resultMap="selectHospitalWithLocation">
		
	
              select ROWNUM as rnum, hname, haddress, hpn
           
                  FROM hospital 
                  WHERE SUBSTR(haddress,1,2)=#{locationHaddress}
               
	
	</select>
	

	
	
	


</mapper>