<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycompany.webapp.dao.ProgressDao">
	
	<select id="selectByPager" parameterType="pager"  resultMap="selectProgressWithHospitalResultMap">
		select rnum, hname, pdate, pcontent, hpn, pcategory
		    from (
		        select ROWNUM as rnum, hname, pdate, pcontent, hpn, pcategory
		        from (
		            SELECT hname, pdate, pcontent, hpn, pcategory
		            FROM hospital, progress
		            where hospital.hdln = progress.pdln and hospital.haddress = progress.paddress
		        )
		    where rownum &lt;= #{endRowNo}
		    )
		where rnum &gt;= #{startRowNo}
		
	</select>
	
	<select id="count" resultType="int">
		select count(*)
		from progress, hospital
		where hospital.hdln = progress.pdln and hospital.haddress = progress.paddress
	</select>
	
	<resultMap id="selectProgressWithHospitalResultMap" type="progress">
		<result column="rnum" property="pno" />
		<result column="pdate" property="pdate" />
		<result column="pcontent" property="pcontent" />
		<result column="pcategory" property="pcategory" />
		<association property="hospital" javaType="hospital">
			<result column="hname" property="hname" />
			<result column="hpn" property="hpn" />
		</association>
	</resultMap>
	
	<resultMap id="selectProgressWithHospitalResultMap2" type="progress">
		<result column="pdate" property="pdate" />
		<result column="pcontent" property="pcontent" />
		<result column="pcategory" property="pcategory" />
		<collection property="hospital" ofType="Hospital" column="pdln" select="selectAll"></collection>
	</resultMap>
	
	<select id="selectAll" resultMap="selectProgressWithHospitalResultMap">
		select *
		from progress, hospital
		where progress.pdln = hospital.hdln and progress.paddress = hospital.haddress
	</select>

</mapper>